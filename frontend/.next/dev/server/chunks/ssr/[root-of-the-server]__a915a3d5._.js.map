{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 106, "column": 0}, "map": {"version":3,"sources":["file:///home/snoo/caravan-app/frontend/src/app/caravans/%5Bid%5D/page.tsx"],"sourcesContent":["\"use client\";\n\nimport { useEffect, useState } from \"react\";\nimport { useParams, useRouter } from \"next/navigation\";\nimport axios from \"axios\";\n\n// 데이터 타입 정의 (백엔드와 통일: pricePerDay)\ninterface Caravan {\n  // ID 타입은 UUID 문자열이지만, 여기서는 편의상 Number로 가정 (실제 사용은 string)\n  id: string; // 실제 데이터 타입을 string으로 가정\n  name: string;\n  description: string;\n  location: string;\n  pricePerDay: number; // 🚨 [핵심 수정] pricePerDay로 타입 정의\n  images: string[];\n  hostId: string; // 호스트 ID도 string (UUID)으로 가정\n}\n\nexport default function CaravanDetailPage() {\n  const { id } = useParams(); // URL 파라미터 가져오기\n  const router = useRouter();\n\n  // 상태 관리\n  const [caravan, setCaravan] = useState<Caravan | null>(null);\n  const [loading, setLoading] = useState(true);\n  \n  // 예약 관련 상태\n  const [startDate, setStartDate] = useState(\"\");\n  const [endDate, setEndDate] = useState(\"\");\n  const [totalPrice, setTotalPrice] = useState(0);\n  const [isSubmitting, setIsSubmitting] = useState(false);\n\n  // 1. 카라반 상세 정보 불러오기\n  useEffect(() => {\n    if (!id) return;\n    \n    const fetchCaravan = async () => {\n      try {\n        const response = await axios.get(`http://localhost:3001/api/caravans/${id}`);\n        setCaravan(response.data);\n      } catch (error) {\n        console.error(\"카라반 정보 로딩 실패:\", error);\n        alert(\"카라반 정보를 불러올 수 없습니다.\");\n      } finally {\n        setLoading(false);\n      }\n    };\n\n    fetchCaravan();\n  }, [id]);\n\n  // 2. 날짜 변경 시 총 가격 자동 계산\n  useEffect(() => {\n    if (startDate && endDate && caravan) {\n      const start = new Date(startDate);\n      const end = new Date(endDate);\n      \n      // 날짜 차이 계산 (밀리초 단위 -> 일 단위 변환)\n      const diffTime = end.getTime() - start.getTime();\n      const diffDays = diffTime / (1000 * 3600 * 24);\n\n      if (diffDays > 0) {\n        // 🚨 [핵심 수정 1] pricePerNight -> pricePerDay로 변경\n        setTotalPrice(diffDays * caravan.pricePerDay);\n      } else {\n        setTotalPrice(0);\n      }\n    }\n  }, [startDate, endDate, caravan]);\n\n  // 3. 예약 요청 핸들러\n  const handleReservation = async (e: React.FormEvent) => {\n    e.preventDefault();\n\n    // 유효성 검사\n    if (!startDate || !endDate) {\n      alert(\"체크인 및 체크아웃 날짜를 선택해주세요.\");\n      return;\n    }\n    if (totalPrice <= 0) {\n      alert(\"올바른 날짜 범위를 선택해주세요.\");\n      return;\n    }\n\n    // 로그인 확인 (localStorage)\n    const storedUser = localStorage.getItem(\"user\");\n    if (!storedUser) {\n      alert(\"로그인이 필요한 서비스입니다.\");\n      router.push(\"/auth/login\");\n      return;\n    }\n    const user = JSON.parse(storedUser);\n\n    if (confirm(`총 ${totalPrice.toLocaleString()}원으로 예약을 요청하시겠습니까?`)) {\n      setIsSubmitting(true);\n      try {\n        // 예약 요청 API 호출\n        await axios.post(\"http://localhost:3001/api/reservations\", {\n          caravanId: id, // ID는 이미 string (UUID)\n          guestId: user.id, // Host ID와 동일하게 string (UUID)\n          startDate,\n          endDate,\n          totalPrice,\n        });\n\n        alert(\"예약이 요청되었습니다! 호스트 승인을 기다리세요.\");\n        router.push(\"/my\"); // 마이페이지로 이동\n\n      } catch (error: any) {\n        console.error(\"예약 실패:\", error);\n        if (error.response && error.response.status === 409) {\n          alert(\"이미 예약된 날짜입니다. 다른 날짜를 선택해주세요.\");\n        } else {\n          alert(\"예약 요청 중 오류가 발생했습니다.\");\n        }\n      } finally {\n        setIsSubmitting(false);\n      }\n    }\n  };\n\n  if (loading) return <div className=\"text-center py-20\">로딩 중...</div>;\n  if (!caravan) return <div className=\"text-center py-20\">카라반을 찾을 수 없습니다.</div>;\n\n  return (\n    <div className=\"max-w-6xl mx-auto p-6\">\n      {/* 화면 레이아웃: 데스크탑에서는 3컬럼 중 2칸은 정보, 1칸은 예약창 */}\n      <div className=\"grid grid-cols-1 md:grid-cols-3 gap-8\">\n        \n        {/* --- [왼쪽] 카라반 상세 정보 --- */}\n        <div className=\"md:col-span-2 space-y-6\">\n          {/* 이미지 영역 (임시 플레이스홀더) */}\n          <div className=\"w-full h-80 bg-gray-200 rounded-xl flex items-center justify-center text-gray-500 text-lg\">\n            {caravan.images && caravan.images.length > 0 \n              ? \"이미지 슬라이더 들어갈 자리\" \n              : \"이미지 없음\"}\n          </div>\n\n          <div>\n            <h1 className=\"text-3xl font-bold text-gray-900 mb-2\">{caravan.name}</h1>\n            <p className=\"text-gray-500 flex items-center\">\n              📍 {caravan.location}\n            </p>\n          </div>\n\n          <div className=\"border-t pt-6\">\n            <h2 className=\"text-xl font-semibold mb-4\">카라반 소개</h2>\n            <p className=\"text-gray-700 leading-relaxed whitespace-pre-wrap\">\n              {caravan.description}\n            </p>\n          </div>\n          \n          <div className=\"border-t pt-6\">\n            <h2 className=\"text-xl font-semibold mb-4\">호스트 정보</h2>\n            <p className=\"text-gray-600\">호스트 ID: {caravan.hostId}</p>\n          </div>\n        </div>\n\n        {/* --- [오른쪽] 예약 위젯 (사이드바) --- */}\n        <div className=\"md:col-span-1\">\n          <div className=\"sticky top-8 bg-white border border-gray-200 rounded-xl shadow-lg p-6\">\n            <div className=\"flex justify-between items-end mb-6\">\n              <span className=\"text-2xl font-bold text-gray-900\">\n                {/* 🚨 [핵심 수정 2] pricePerNight -> pricePerDay로 변경 */}\n                ₩{caravan.pricePerDay.toLocaleString()}\n              </span>\n              <span className=\"text-gray-500 mb-1\">/ 1박</span>\n            </div>\n\n            <form onSubmit={handleReservation} className=\"space-y-4\">\n              <div className=\"border rounded-lg p-2\">\n                <div className=\"border-b p-2\">\n                  <label className=\"block text-xs font-bold text-gray-800 uppercase\">체크인</label>\n                  <input \n                    type=\"date\" \n                    value={startDate}\n                    onChange={(e) => setStartDate(e.target.value)}\n                    className=\"w-full outline-none text-gray-600 mt-1\"\n                    required\n                  />\n                </div>\n                <div className=\"p-2\">\n                  <label className=\"block text-xs font-bold text-gray-800 uppercase\">체크아웃</label>\n                  <input \n                    type=\"date\" \n                    value={endDate}\n                    onChange={(e) => setEndDate(e.target.value)}\n                    min={startDate} // 체크인 날짜 이후만 선택 가능\n                    className=\"w-full outline-none text-gray-600 mt-1\"\n                    required\n                  />\n                </div>\n              </div>\n\n              <button\n                type=\"submit\"\n                disabled={isSubmitting}\n                className={`w-full py-3 rounded-lg text-white font-bold text-lg transition\n                  ${isSubmitting \n                    ? \"bg-gray-400 cursor-not-allowed\" \n                    : \"bg-rose-600 hover:bg-rose-700\"}`}\n              >\n                {isSubmitting ? \"처리 중...\" : \"예약 요청하기\"}\n              </button>\n            </form>\n\n            {/* 가격 계산 결과 표시 */}\n            {totalPrice > 0 && (\n              <div className=\"mt-6 pt-4 border-t space-y-2\">\n                <div className=\"flex justify-between text-gray-600\">\n                  <span className=\"underline\">\n                    {/* 🚨 [핵심 수정 3] pricePerNight -> pricePerDay로 변경 */}\n                    ₩{caravan.pricePerDay.toLocaleString()} x {(totalPrice / caravan.pricePerDay)}박\n                  </span>\n                  <span>₩{totalPrice.toLocaleString()}</span>\n                </div>\n                <div className=\"flex justify-between font-bold text-lg text-gray-900 border-t pt-4 mt-2\">\n                  <span>총 합계</span>\n                  <span>₩{totalPrice.toLocaleString()}</span>\n                </div>\n              </div>\n            )}\n          </div>\n        </div>\n        \n      </div>\n    </div>\n  );\n}"],"names":[],"mappings":"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"}}]
}