{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 88, "column": 0}, "map": {"version":3,"sources":["file:///home/snoo/caravan-app/frontend/src/app/my/profile/page.tsx"],"sourcesContent":["\"use client\";\n\nimport { useEffect, useState } from 'react';\nimport { useRouter } from 'next/navigation';\nimport axios from 'axios';\n// User ÌÉÄÏûÖÏù¥ '@/types/user'ÏóêÏÑú Ïò¨Î∞îÎ•¥Í≤å import ÎêòÏóàÎã§Í≥† Í∞ÄÏ†ïÌï©ÎãàÎã§.\nimport { User } from '@/types/user'; \n\n// üö® API_BASE_URL ÏÉÅÏàòÎ•º Ï†úÍ±∞ÌïòÍ≥† ÏÉÅÎåÄ Í≤ΩÎ°úÎ•º ÏÇ¨Ïö©ÌïòÏó¨ Next.js ÌîÑÎ°ùÏãú ÏÑ§Ï†ïÏùÑ ÌôúÏö©Ìï©ÎãàÎã§.\n// Î∞±ÏóîÎìú Í≤ΩÎ°úÍ∞Ä 'http://localhost:3001/api/users'ÎùºÍ≥† Í∞ÄÏ†ïÌïòÎ©¥, \n// ÌîÑÎ°†Ìä∏ÏóêÏÑúÎäî '/api/users'Î°ú ÏöîÏ≤≠ÏùÑ Î≥¥ÎÉÖÎãàÎã§.\nconst API_PREFIX = '/api/users'; // Next.jsÍ∞Ä 3001Î°ú ÌîÑÎ°ùÏãúÌï¥Ï£ºÍ∏∞Î•º Í∏∞ÎåÄÌï©ÎãàÎã§.\n\nconst ProfilePage = () => {\n  const [user, setUser] = useState<User | null>(null);\n  const [name, setName] = useState('');\n  const [contactNumber, setContactNumber] = useState('');\n  const [loading, setLoading] = useState(true);\n  const [error, setError] = useState<string | null>(null);\n  const [isEditing, setIsEditing] = useState(false);\n  const [showUpdateSuccess, setShowUpdateSuccess] = useState(false); // Alert ÎåÄÏã† ÏÇ¨Ïö©Ìï† ÏÉÅÌÉú\n  const router = useRouter();\n\n  // 1. ÏÇ¨Ïö©Ïûê Ï†ïÎ≥¥ Ï°∞Ìöå (GET /api/users/:id)\n  useEffect(() => {\n    const fetchUser = async () => {\n      // üö® [Ï§ëÏöî: LocalStorage ÎåÄÏã† Firebase ÏÇ¨Ïö© Í∂åÏû•]\n      // Ïã§Ï†ú ÌîÑÎ°úÎçïÏÖò ÌôòÍ≤ΩÏóêÏÑúÎäî localStorage ÎåÄÏã† ÏïàÏ†ÑÌïú Ïù∏Ï¶ù Î∞è FirestoreÎ•º ÏÇ¨Ïö©Ìï¥Ïïº Ìï©ÎãàÎã§.\n      const storedUser = localStorage.getItem('user');\n      if (!storedUser) {\n        router.push('/auth/login');\n        return;\n      }\n\n      const { id: userId } = JSON.parse(storedUser);\n      if (!userId) {\n        router.push('/auth/login');\n        return;\n      }\n\n      try {\n        // ‚úÖ ÏàòÏ†ïÎêú Í≤ΩÎ°ú: ÏÉÅÎåÄ Í≤ΩÎ°ú ÏÇ¨Ïö©. Next.jsÍ∞Ä ÏÑ§Ï†ïÎêú ÌîÑÎ°ùÏãú Í∑úÏπôÏóê Îî∞Îùº \n        // Ïù¥ ÏöîÏ≤≠ÏùÑ 'http://localhost:3001/api/users/{userId}'Î°ú Ï†ÑÎã¨Ìï† Í≤ÉÏûÖÎãàÎã§.\n        const response = await axios.get(`${API_PREFIX}/${userId}`);\n        \n        // Next.js Í∞úÎ∞ú ÏÑúÎ≤ÑÎ•º ÏÇ¨Ïö©ÌïòÍ≥† ÏûàÎã§Î©¥, `response.status !== 200` Í≤ÄÏÇ¨Îäî AxiosÏùò\n        // catch Î∏îÎ°ùÏóêÏÑú Ï≤òÎ¶¨ÎêòÎØÄÎ°ú Ï†úÍ±∞ÌïòÍ±∞ÎÇò 2xx ÏΩîÎìúÎßå Í≤ÄÏÇ¨ÌïòÎäî Í≤ÉÏù¥ Ï¢ãÏäµÎãàÎã§.\n        \n        const data: User = response.data;\n        setUser(data);\n        setName(data.name);\n        setContactNumber(data.contactNumber || '');\n        \n      } catch (err: any) {\n        console.error('Fetch Error (404 Likely):', err);\n        // 404/500 ÏóêÎü¨ Ï≤òÎ¶¨\n        setError(err.response?.data?.message || 'Failed to fetch user data');\n      } finally {\n        setLoading(false);\n      }\n    };\n\n    fetchUser();\n  }, [router]);\n\n  // 2. ÏÇ¨Ïö©Ïûê Ï†ïÎ≥¥ ÏóÖÎç∞Ïù¥Ìä∏ (PATCH /api/users/:id)\n  const handleUpdate = async () => {\n    if (!user) return;\n    setLoading(true);\n\n    try {\n      // ‚úÖ ÏàòÏ†ïÎêú Í≤ΩÎ°ú: ÏÉÅÎåÄ Í≤ΩÎ°ú ÏÇ¨Ïö©\n      const response = await axios.patch(`${API_PREFIX}/${user.id}`, {\n        name,\n        contactNumber,\n      });\n\n      const updatedUser: User = response.data;\n      \n      // LocalStorage ÏóÖÎç∞Ïù¥Ìä∏\n      const currentStoredUser = JSON.parse(localStorage.getItem('user') || '{}');\n      localStorage.setItem('user', JSON.stringify({\n        ...currentStoredUser,\n        name: updatedUser.name,\n        contactNumber: updatedUser.contactNumber,\n      }));\n\n      // UI ÏÉÅÌÉú ÏóÖÎç∞Ïù¥Ìä∏\n      setUser(updatedUser);\n      setName(updatedUser.name);\n      setContactNumber(updatedUser.contactNumber || '');\n      setIsEditing(false);\n      setShowUpdateSuccess(true); // ÏÑ±Í≥µ ÏïåÎ¶º ÌëúÏãú\n      setTimeout(() => setShowUpdateSuccess(false), 3000); // 3Ï¥à ÌõÑ Ïà®ÍπÄ\n\n    } catch (err: any) {\n      console.error('Update Error:', err);\n      setError(err.response?.data?.message || 'An unknown error occurred during update.');\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  // ----------------------------------------------------------------------\n  // Î†åÎçîÎßÅ Î°úÏßÅ\n  // ----------------------------------------------------------------------\n  if (loading) {\n    return <div className=\"flex justify-center items-center h-screen\">Loading...</div>;\n  }\n\n  // üö® [ÏàòÏ†ï 3] ÏóêÎü¨ Î∞úÏÉù Ïãú UI Í∞úÏÑ†: Failed to fetch user data Î©îÏãúÏßÄ ÌëúÏãú\n  if (error) {\n    return (\n      <div className=\"flex justify-center items-center h-screen\">\n        <div className=\"text-red-600 bg-red-100 p-6 rounded-lg shadow-xl text-center\">\n          <p className=\"text-xl font-bold mb-2\">Error</p>\n          <p className=\"text-lg\">{error}</p>\n          <p className=\"mt-4 text-sm text-red-500\">\n            (Hint: Î∞±ÏóîÎìú ÏÑúÎ≤ÑÍ∞Ä 'http://localhost:3001'ÏóêÏÑú Ïã§Ìñâ Ï§ëÏù∏ÏßÄ, \n            API Í≤ΩÎ°ú '{API_PREFIX}/{user?.id || 'ID'}'Í∞Ä Ïú†Ìö®ÌïúÏßÄ ÌôïÏù∏ÌïòÏÑ∏Ïöî.)\n          </p>\n          <button \n             onClick={() => router.push('/')}\n             className=\"mt-3 text-white bg-red-500 hover:bg-red-700 py-1 px-3 rounded-md\"\n          >\n             Go Home\n          </button>\n        </div>\n      </div>\n    );\n  }\n\n  if (!user) {\n    return null; \n  }\n\n  return (\n    <div className=\"container mx-auto px-4 py-8 relative\">\n      {/* ÏÑ±Í≥µ ÏïåÎ¶º Î™®Îã¨/Î©îÏãúÏßÄ */}\n      {showUpdateSuccess && (\n        <div className=\"absolute top-0 right-0 mt-4 mr-4 bg-green-500 text-white py-2 px-4 rounded-lg shadow-lg transition duration-300\">\n          ÌîÑÎ°úÌïÑÏù¥ ÏÑ±Í≥µÏ†ÅÏúºÎ°ú ÏóÖÎç∞Ïù¥Ìä∏ÎêòÏóàÏäµÎãàÎã§.\n        </div>\n      )}\n\n      <h1 className=\"text-3xl font-extrabold text-gray-900 mb-8 text-center\">\n        {user.name} ÎãòÏùò ÌîÑÎ°úÌïÑ\n      </h1>\n      <div className=\"bg-white shadow-2xl border border-gray-100 rounded-xl p-8 max-w-lg mx-auto transform transition duration-500 hover:scale-[1.01]\">\n        <div className=\"space-y-6\">\n          <ProfileField label=\"Name\" isEditing={isEditing} value={name}>\n            <input\n              type=\"text\"\n              value={name}\n              onChange={(e) => setName(e.target.value)}\n              className=\"mt-1 shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:ring-2 focus:ring-indigo-500 transition duration-150\"\n            />\n          </ProfileField>\n\n          <ProfileField label=\"Email\" isEditing={false} value={user.email}>\n            <p className=\"text-gray-900 font-medium\">{user.email}</p>\n          </ProfileField>\n\n          <ProfileField label=\"Contact Number\" isEditing={isEditing} value={contactNumber}>\n            <input\n              type=\"text\"\n              value={contactNumber}\n              onChange={(e) => setContactNumber(e.target.value)}\n              className=\"mt-1 shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:ring-2 focus:ring-indigo-500 transition duration-150\"\n            />\n          </ProfileField>\n\n          <ProfileField label=\"Rating\" isEditing={false} value={user.rating}>\n            <p className=\"text-gray-900 font-medium\">{user.rating ? `${user.rating.toFixed(1)} / 5.0` : 'No ratings yet'}</p>\n          </ProfileField>\n\n          <div className=\"pt-2\">\n            <label className=\"block text-sm font-semibold text-gray-600 mb-2\">Identity Verification</label>\n            <span\n              className={`px-3 py-1 text-xs font-bold leading-tight rounded-full shadow ${\n                user.isVerified ? 'bg-green-500 text-white' : 'bg-yellow-500 text-white'\n              }`}\n            >\n              {user.isVerified ? 'Verified' : 'Pending Verification'}\n            </span>\n          </div>\n        </div>\n        \n        <div className=\"mt-8 flex justify-end space-x-4 border-t pt-6\">\n          {isEditing ? (\n            <>\n              <button\n                onClick={handleUpdate}\n                disabled={loading}\n                className=\"bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-2 px-4 rounded-lg shadow-md transition duration-150 disabled:opacity-50\"\n              >\n                {loading ? 'Saving...' : 'Save Changes'}\n              </button>\n              <button\n                onClick={() => { setIsEditing(false); setName(user.name); setContactNumber(user.contactNumber || ''); }}\n                disabled={loading}\n                className=\"bg-gray-400 hover:bg-gray-500 text-white font-bold py-2 px-4 rounded-lg shadow-md transition duration-150 disabled:opacity-50\"\n              >\n                Cancel\n              </button>\n            </>\n          ) : (\n            <button\n              onClick={() => setIsEditing(true)}\n              className=\"bg-indigo-500 hover:bg-indigo-600 text-white font-bold py-2 px-6 rounded-lg shadow-md transition duration-150\"\n            >\n              Edit Profile\n            </button>\n          )}\n        </div>\n      </div>\n    </div>\n  );\n};\n\n// Ïû¨ÏÇ¨Ïö© Í∞ÄÎä•Ìïú ÌïÑÎìú Ïª¥Ìè¨ÎÑåÌä∏\nconst ProfileField = ({ label, isEditing, children, value }: { label: string, isEditing: boolean, children: React.ReactNode, value: any }) => (\n  <div>\n    <label className=\"block text-sm font-semibold text-gray-600 mb-1\">{label}</label>\n    {isEditing ? children : (\n      <p className=\"text-gray-900 font-medium bg-gray-50 p-2 rounded-md border border-gray-200\">{value}</p>\n    )}\n  </div>\n);\n\nexport default ProfilePage;"],"names":[],"mappings":"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"}}]
}