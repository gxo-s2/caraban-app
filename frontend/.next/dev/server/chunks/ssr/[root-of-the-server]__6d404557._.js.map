{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 106, "column": 0}, "map": {"version":3,"sources":["file:///home/snoo/caravan-app/frontend/src/app/my/reservations/page.tsx"],"sourcesContent":["'use client';\n\nimport { useEffect, useState } from 'react';\nimport axios from 'axios';\nimport { useRouter } from 'next/navigation';\n\n// --- 타입 정의 ---\ninterface Payment {\n  status: 'COMPLETED' | 'REFUNDED';\n}\ninterface Reservation {\n  id: string;\n  startDate: string;\n  endDate: string;\n  totalPrice: number;\n  status: 'PENDING' | 'CONFIRMED' | 'CANCELLED';\n  caravan: {\n    id: string;\n    name: string;\n    location: string;\n    images: string[];\n  };\n  payment: Payment[]; // 결제 정보 포함\n}\n\n// --- 컴포넌트 ---\n\n// 상태 뱃지 컴포넌트\nconst StatusBadge = ({ status, paymentStatus }: { status: Reservation['status'], paymentStatus?: Payment['status'] }) => {\n  let text = '';\n  let style = '';\n\n  if (status === 'CANCELLED') {\n    text = paymentStatus === 'REFUNDED' ? '환불 완료' : '취소됨';\n    style = 'bg-red-100 text-red-800';\n  } else if (status === 'CONFIRMED') {\n    text = '예약 확정';\n    style = 'bg-green-100 text-green-800';\n  } else if (status === 'PENDING') {\n    text = '호스트 승인 대기중';\n    style = 'bg-yellow-100 text-yellow-800';\n  }\n\n  return <span className={`px-3 py-1 rounded-full text-xs font-bold ${style}`}>{text}</span>;\n};\n\n\nexport default function MyReservationsPage() {\n  const [reservations, setReservations] = useState<Reservation[]>([]);\n  const [loading, setLoading] = useState(true);\n  const [error, setError] = useState('');\n  const [processingId, setProcessingId] = useState<string | null>(null); // 취소 처리 중인 ID\n  const router = useRouter();\n\n  // --- 데이터 로딩 ---\n  useEffect(() => {\n    const fetchReservations = async () => {\n      try {\n        const userStr = localStorage.getItem('user');\n        if (!userStr) {\n          setError('로그인이 필요합니다.');\n          router.push('/auth/login');\n          return;\n        }\n        const user = JSON.parse(userStr);\n        // 백엔드 API 경로 수정 (getMyReservations에 맞게)\n        const response = await axios.get(`http://localhost:3001/api/reservations/user/${user.id}`);\n        setReservations(response.data);\n      } catch (err: any) {\n        setError('예약 내역을 불러오는 데 실패했습니다.');\n        console.error('예약 로딩 실패:', err);\n      } finally {\n        setLoading(false);\n      }\n    };\n    fetchReservations();\n  }, [router]);\n\n  // --- 이벤트 핸들러 ---\n  const handleCancelReservation = async (id: string) => {\n    if (!confirm('정말 예약을 취소하시겠습니까? 결제 금액이 환불 처리됩니다.')) return;\n\n    setProcessingId(id);\n    try {\n      await axios.patch(`http://localhost:3001/api/reservations/${id}/status`, {\n        status: 'CANCELLED',\n      });\n      // UI 즉시 업데이트\n      setReservations(prev =>\n        prev.map(r => \n          r.id === id \n            ? { ...r, status: 'CANCELLED', payment: [{ status: 'REFUNDED' }] } // 가상으로 환불 상태 반영\n            : r\n        )\n      );\n      alert('예약이 취소되었습니다.');\n    } catch (err) {\n      alert('예약 취소 중 오류가 발생했습니다.');\n      console.error('예약 취소 실패:', err);\n    } finally {\n      setProcessingId(null);\n    }\n  };\n\n  const formatDate = (date: string) => new Date(date).toLocaleDateString('ko-KR');\n\n  // --- 렌더링 로직 ---\n  if (loading) return <div className=\"text-center p-10\">로딩 중...</div>;\n  if (error) return <div className=\"text-center text-red-500 p-10\">{error}</div>;\n\n  return (\n    <div className=\"max-w-7xl mx-auto p-4 sm:p-6\">\n      <h1 className=\"text-3xl font-bold text-gray-900 mb-8\">내 예약 목록</h1>\n\n      {reservations.length === 0 ? (\n        <div className=\"text-center py-20 bg-gray-50 rounded-lg\">\n          <p className=\"text-gray-600\">아직 예약된 여행이 없습니다.</p>\n        </div>\n      ) : (\n        <div className=\"space-y-6\">\n          {reservations.map(res => (\n            <div key={res.id} className=\"bg-white border border-gray-200 rounded-xl shadow-sm overflow-hidden\">\n              <div className=\"grid grid-cols-1 md:grid-cols-3\">\n                {/* 이미지 영역 */}\n                <div className=\"md:col-span-1\">\n                  <img\n                    src={res.caravan.images?.[0] || 'https://via.placeholder.com/400x300?text=No+Image'}\n                    alt={res.caravan.name}\n                    className=\"w-full h-48 md:h-full object-cover\"\n                  />\n                </div>\n                \n                {/* 정보 영역 */}\n                <div className=\"md:col-span-2 p-6\">\n                  <div className=\"flex justify-between items-start\">\n                    <div>\n                      <h2 className=\"text-xl font-bold text-gray-800\">{res.caravan.name}</h2>\n                      <p className=\"text-sm text-gray-500 mt-1\">{res.caravan.location}</p>\n                    </div>\n                    <StatusBadge status={res.status} paymentStatus={res.payment?.[0]?.status} />\n                  </div>\n\n                  <div className=\"mt-4 pt-4 border-t border-gray-100 grid grid-cols-2 gap-4 text-sm\">\n                    <div>\n                      <p className=\"text-gray-500\">체크인</p>\n                      <p className=\"font-semibold text-gray-900\">{formatDate(res.startDate)}</p>\n                    </div>\n                    <div>\n                      <p className=\"text-gray-500\">체크아웃</p>\n                      <p className=\"font-semibold text-gray-900\">{formatDate(res.endDate)}</p>\n                    </div>\n                    <div>\n                      <p className=\"text-gray-500\">결제 금액</p>\n                      <p className=\"font-semibold text-gray-900\">₩{res.totalPrice.toLocaleString()}</p>\n                    </div>\n                  </div>\n\n                  {/* 예약 취소 버튼 */}\n                  {(res.status === 'PENDING' || res.status === 'CONFIRMED') && (\n                    <div className=\"mt-6 text-right\">\n                      <button\n                        onClick={() => handleCancelReservation(res.id)}\n                        disabled={processingId === res.id}\n                        className=\"px-4 py-2 text-sm font-medium text-white bg-red-600 rounded-lg hover:bg-red-700 disabled:bg-gray-400 disabled:cursor-wait transition\"\n                      >\n                        {processingId === res.id ? '취소 처리 중...' : '예약 취소'}\n                      </button>\n                    </div>\n                  )}\n                </div>\n              </div>\n            </div>\n          ))}\n        </div>\n      )}\n    </div>\n  );\n}"],"names":[],"mappings":"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"}}]
}