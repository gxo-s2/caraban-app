{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///home/snoo/caravan-app/frontend/src/app/my/profile/page.tsx"],"sourcesContent":["\"use client\";\n\nimport { useEffect, useState } from 'react';\nimport { useRouter } from 'next/navigation';\n// User ÌÉÄÏûÖÏù¥ '@/types/user'ÏóêÏÑú Ïò¨Î∞îÎ•¥Í≤å import ÎêòÏóàÎã§Í≥† Í∞ÄÏ†ïÌï©ÎãàÎã§.\nimport { User } from '@/types/user'; \nimport axios from 'axios'; // fetch ÎåÄÏã† axiosÎ•º ÏÇ¨Ïö©ÌïòÏó¨ Ïò§Î•ò Ï≤òÎ¶¨Ïùò ÏùºÍ¥ÄÏÑ±ÏùÑ ÌôïÎ≥¥Ìï©ÎãàÎã§.\n\n// Î∞±ÏóîÎìú ÏÑúÎ≤Ñ Ï£ºÏÜå (Î™®Îì† API Ìò∏Ï∂úÏóê ÏÇ¨Ïö©)\nconst API_BASE_URL = 'http://localhost:3001/api/users'; \n\nconst ProfilePage = () => {\n  const [user, setUser] = useState<User | null>(null);\n  const [name, setName] = useState('');\n  const [contactNumber, setContactNumber] = useState('');\n  const [loading, setLoading] = useState(true);\n  const [error, setError] = useState<string | null>(null);\n  const [isEditing, setIsEditing] = useState(false);\n  const router = useRouter();\n\n  // 1. ÏÇ¨Ïö©Ïûê Ï†ïÎ≥¥ Ï°∞Ìöå (GET /api/users/:id)\n  useEffect(() => {\n    const fetchUser = async () => {\n      const storedUser = localStorage.getItem('user');\n      if (!storedUser) {\n        router.push('/auth/login');\n        return;\n      }\n\n      const { id: userId } = JSON.parse(storedUser);\n      if (!userId) {\n        router.push('/auth/login');\n        return;\n      }\n\n      try {\n        // üö® [ÏàòÏ†ï 1] Ï†àÎåÄ Í≤ΩÎ°úÎ°ú Î≥ÄÍ≤Ω: http://localhost:3001/api/users/${userId}\n        const response = await axios.get(`${API_BASE_URL}/${userId}`);\n        \n        if (response.status !== 200) {\n          throw new Error('Failed to fetch user data');\n        }\n        \n        const data: User = response.data;\n        setUser(data);\n        setName(data.name);\n        setContactNumber(data.contactNumber || '');\n        \n      } catch (err: any) {\n        console.error('Fetch Error:', err);\n        // 404/500 ÏóêÎü¨ Î©îÏãúÏßÄ Ï≤òÎ¶¨\n        setError(err.response?.data?.message || 'Failed to fetch user data');\n      } finally {\n        setLoading(false);\n      }\n    };\n\n    fetchUser();\n  }, [router]);\n\n  // 2. ÏÇ¨Ïö©Ïûê Ï†ïÎ≥¥ ÏóÖÎç∞Ïù¥Ìä∏ (PATCH /api/users/:id)\n  const handleUpdate = async () => {\n    if (!user) return;\n    setLoading(true); // ÏóÖÎç∞Ïù¥Ìä∏ Ï§ë Î°úÎî© ÏÉÅÌÉú ÌôúÏÑ±Ìôî\n\n    try {\n      const response = await axios.patch(`${API_BASE_URL}/${user.id}`, {\n        name,\n        contactNumber,\n      });\n\n      if (response.status !== 200) {\n        throw new Error('Failed to update user data');\n      }\n\n      const updatedUser: User = response.data;\n      \n      // LocalStorageÎèÑ ÏóÖÎç∞Ïù¥Ìä∏ (Ïù¥Î¶Ñ, Ïó∞ÎùΩÏ≤ò)\n      const currentStoredUser = JSON.parse(localStorage.getItem('user') || '{}');\n      localStorage.setItem('user', JSON.stringify({\n        ...currentStoredUser,\n        name: updatedUser.name,\n        contactNumber: updatedUser.contactNumber,\n      }));\n\n      // UI ÏÉÅÌÉú ÏóÖÎç∞Ïù¥Ìä∏\n      setUser(updatedUser);\n      setName(updatedUser.name);\n      setContactNumber(updatedUser.contactNumber || '');\n      setIsEditing(false);\n      alert(\"ÌîÑÎ°úÌïÑÏù¥ ÏÑ±Í≥µÏ†ÅÏúºÎ°ú ÏóÖÎç∞Ïù¥Ìä∏ÎêòÏóàÏäµÎãàÎã§.\");\n\n    } catch (err: any) {\n      console.error('Update Error:', err);\n      setError(err.response?.data?.message || 'An unknown error occurred during update.');\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  if (loading) {\n    return <div className=\"flex justify-center items-center h-screen\">Loading...</div>;\n  }\n\n  if (error) {\n    return <div className=\"flex justify-center items-center h-screen text-red-500 font-bold text-xl p-8\">{error}</div>;\n  }\n\n  if (!user) {\n    return null; \n  }\n\n  return (\n    <div className=\"container mx-auto px-4 py-8\">\n      <h1 className=\"text-3xl font-bold mb-6\">My Profile</h1>\n      <div className=\"bg-white shadow-md rounded-lg p-6 max-w-lg mx-auto\">\n        <div className=\"mb-4\">\n          <label className=\"block text-gray-700 text-sm font-bold mb-2\">Name</label>\n          {isEditing ? (\n            <input\n              type=\"text\"\n              value={name}\n              onChange={(e) => setName(e.target.value)}\n              className=\"shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline\"\n            />\n          ) : (\n            <p className=\"text-gray-900 font-medium\">{user.name}</p>\n          )}\n        </div>\n        <div className=\"mb-4\">\n          <label className=\"block text-gray-700 text-sm font-bold mb-2\">Email</label>\n          <p className=\"text-gray-900\">{user.email}</p>\n        </div>\n        <div className=\"mb-4\">\n          <label className=\"block text-gray-700 text-sm font-bold mb-2\">Contact Number</label>\n          {isEditing ? (\n            <input\n              type=\"text\"\n              value={contactNumber}\n              onChange={(e) => setContactNumber(e.target.value)}\n              className=\"shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline\"\n            />\n          ) : (\n            <p className=\"text-gray-900\">{user.contactNumber || 'Not provided'}</p>\n          )}\n        </div>\n        <div className=\"mb-4\">\n          <label className=\"block text-gray-700 text-sm font-bold mb-2\">Rating</label>\n          {/* üö® [ÏàòÏ†ï 2] user.ratingÏù¥ ÏóÜÏùÑ Í≤ΩÏö∞ Ïò§Î•ò Î∞©ÏßÄ Ï≤òÎ¶¨ */}\n          <p className=\"text-gray-900\">{user.rating ? `${user.rating.toFixed(1)} / 5.0` : 'No ratings yet'}</p>\n        </div>\n        <div className=\"mb-4\">\n          <label className=\"block text-gray-700 text-sm font-bold mb-2\">Identity Verification</label>\n          <span\n            className={`px-3 py-1 text-sm font-semibold leading-tight rounded-full ${\n              user.isVerified ? 'bg-green-100 text-green-800' : 'bg-red-100 text-red-800'\n            }`}\n          >\n            {user.isVerified ? 'Verified' : 'Not Verified'}\n          </span>\n        </div>\n        <div className=\"mt-6\">\n          {isEditing ? (\n            <>\n              <button\n                onClick={handleUpdate}\n                className=\"bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded focus:outline-none focus:shadow-outline mr-3\"\n              >\n                Save Changes\n              </button>\n              <button\n                onClick={() => { setIsEditing(false); setName(user.name); setContactNumber(user.contactNumber || ''); }}\n                className=\"bg-gray-500 hover:bg-gray-700 text-white font-bold py-2 px-4 rounded focus:outline-none focus:shadow-outline\"\n              >\n                Cancel\n              </button>\n            </>\n          ) : (\n            <button\n              onClick={() => setIsEditing(true)}\n              className=\"bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-2 px-4 rounded focus:outline-none focus:shadow-outline\"\n            >\n              Edit Profile\n            </button>\n          )}\n        </div>\n      </div>\n    </div>\n  );\n};\n\nexport default ProfilePage;\n"],"names":[],"mappings":"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"}}]
}