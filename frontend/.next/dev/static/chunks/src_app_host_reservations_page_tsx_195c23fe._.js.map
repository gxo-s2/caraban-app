{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///home/snoo/caravan-app/frontend/src/app/host/reservations/page.tsx"],"sourcesContent":["'use client';\n\nimport { useEffect, useState } from 'react';\nimport { useRouter } from 'next/navigation'; // useRouter import Ï∂îÍ∞Ä\nimport axios from 'axios'; // axios import Ï∂îÍ∞Ä\n\n// üö® [ÏàòÏ†ï 1] import ReservationStatus from '@/types/backend-enums' ÎùºÏù∏ ÏÇ≠Ï†úÎê®\n\n// ÏÉÅÌÉú Í¥ÄÎ¶¨Î•º ÏúÑÌïú ÌÉÄÏûÖ Ï†ïÏùò\ntype ReservationStatus = 'PENDING' | 'CONFIRMED' | 'CANCELLED';\n\ntype User = {\n    id: string; // UUID string\n    name: string;\n    email: string;\n    role: string;\n};\n\ntype Reservation = {\n    id: string;\n    startDate: string;\n    endDate: string;\n    totalPrice: number;\n    status: ReservationStatus; // Î°úÏª¨ Ï†ïÏùò ÌÉÄÏûÖ ÏÇ¨Ïö©\n    hostId: string;\n    guest: { name: string; email: string; };\n    caravan: { name: string; id: string; };\n};\n\n// Helper to format dates\nconst formatDate = (dateString: string) => {\n  return new Date(dateString).toLocaleDateString('ko-KR', {\n    year: 'numeric',\n    month: 'long',\n    day: 'numeric',\n  });\n};\n\n// Helper to get status badge colors (ReservationStatus ÎåÄÏã† string literal ÏÇ¨Ïö©)\nconst getStatusBadgeColor = (status: ReservationStatus) => {\n  switch (status) {\n    case 'PENDING':\n      return 'bg-yellow-100 text-yellow-800';\n    case 'CONFIRMED':\n      return 'bg-green-100 text-green-800';\n    case 'CANCELLED':\n      return 'bg-red-100 text-red-800';\n    default:\n      return 'bg-gray-100 text-gray-800';\n  }\n};\n\nexport default function HostReservationsPage() {\n  const router = useRouter();\n  const [reservations, setReservations] = useState<Reservation[]>([]);\n  const [loading, setLoading] = useState(true);\n  const [error, setError] = useState('');\n  const [hostUser, setHostUser] = useState<User | null>(null);\n\n  // Î∞±ÏóîÎìú API Ï£ºÏÜå\n  const API_URL = 'http://localhost:3001/api/reservations';\n\n  // üö® [ÏàòÏ†ï 2] Î°úÍ∑∏Ïù∏ ÏÉÅÌÉú ÌôïÏù∏ Î∞è Îç∞Ïù¥ÌÑ∞ Î°úÎî© Î°úÏßÅ\n  useEffect(() => {\n    const storedUser = localStorage.getItem('user');\n    if (!storedUser) {\n        setError('Host ID not found. Please log in as a host.');\n        setLoading(false);\n        router.push('/auth/login');\n        return;\n    }\n\n    const parsedUser: User = JSON.parse(storedUser);\n\n    if (parsedUser.role !== 'HOST') {\n        setError('Access Denied. You must be logged in as a host.');\n        setLoading(false);\n        router.push('/');\n        return;\n    }\n    \n    // Ìò∏Ïä§Ìä∏ Ï†ïÎ≥¥ ÏÑ§Ï†ï Î∞è Îç∞Ïù¥ÌÑ∞ Î°úÎî© ÏãúÏûë\n    setHostUser(parsedUser);\n    fetchHostReservations(parsedUser.id);\n  }, [router]);\n\n\n  async function fetchHostReservations(hostId: string) {\n    setLoading(true);\n    try {\n        // Î∞±ÏóîÎìúÏóê Ìò∏Ïä§Ìä∏ IDÎ•º Í∏∞Î∞òÏúºÎ°ú ÌïÑÌÑ∞ÎßÅÎêú ÏòàÏïΩ Î™©Î°ùÏùÑ ÏöîÏ≤≠Ìï©ÎãàÎã§.\n        // ÏûÑÏãú Î°úÏßÅ: /api/reservations/host/:hostId ÏóîÎìúÌè¨Ïù∏Ìä∏Í∞Ä ÏûàÎã§Í≥† Í∞ÄÏ†ïÌï©ÎãàÎã§.\n      const res = await axios.get(`${API_URL}/host/${hostId}`); \n      \n      if (res.status !== 200) {\n        throw new Error('Failed to fetch reservations.');\n      }\n      \n      setReservations(res.data);\n    } catch (err: any) {\n      console.error(err);\n      setError('Failed to fetch reservations. Check backend API logs (GET /api/reservations/host/:id).');\n    } finally {\n      setLoading(false);\n    }\n  }\n\n  const handleStatusUpdate = async (reservationId: string, status: ReservationStatus) => {\n    if (!confirm(`ÏòàÏïΩÏùÑ ${status === 'CONFIRMED' ? 'ÏäπÏù∏' : 'Í±∞Ï†à'}ÌïòÏãúÍ≤†ÏäµÎãàÍπå?`)) return;\n\n    try {\n      // ÏÉÅÌÉú ÏóÖÎç∞Ïù¥Ìä∏ API Ìò∏Ï∂ú\n      const res = await axios.patch(`${API_URL}/${reservationId}/status`, {\n        status: status,\n        hostId: hostUser?.id // Í∂åÌïú Í≤ÄÏ¶ùÏö© hostId Ï†ÑÏÜ°\n      });\n\n      if (res.status !== 200) {\n        throw new Error('Failed to update reservation status.');\n      }\n\n      // Î°úÏª¨ ÏÉÅÌÉú ÏóÖÎç∞Ïù¥Ìä∏\n      setReservations(reservations.map(r => \n        r.id === reservationId ? { ...r, status: status } : r\n      ));\n      alert(`ÏòàÏïΩÏù¥ ${status === 'CONFIRMED' ? 'ÏäπÏù∏' : 'Í±∞Ï†à'}ÎêòÏóàÏäµÎãàÎã§.`);\n      \n    } catch (err: any) {\n      console.error(err);\n      alert(`Error updating status: ${err.response?.data?.message || err.message}`);\n    }\n  };\n  \n  // Guard Clauses (Î°úÎî©/ÏóêÎü¨/Í∂åÌïú Ï≤¥ÌÅ¨)\n  if (loading) return <p className=\"text-center mt-20\">Loading reservations...</p>;\n  if (error) return <p className=\"text-center mt-20 text-red-500 font-bold\">{error}</p>;\n\n  if (!hostUser || hostUser.role !== 'HOST') {\n     return (\n      <main className=\"bg-gray-50 min-h-screen p-8\">\n        <div className=\"max-w-7xl mx-auto text-center\">\n            <h1 className=\"text-2xl font-bold text-red-600\">Access Denied</h1>\n            <p className=\"mt-2 text-gray-600\">You must be logged in as a host to view this page.</p>\n        </div>\n      </main>\n    );\n  }\n\n\n  return (\n    <main className=\"bg-gray-50 min-h-screen p-4 sm:p-8\">\n      <div className=\"max-w-7xl mx-auto\">\n        <h1 className=\"text-3xl font-bold text-gray-900 mb-6\">ÏòàÏïΩ Í¥ÄÎ¶¨ ({hostUser.name}Îãò)</h1>\n        \n        {reservations.length === 0 && (\n          <p className=\"text-gray-500\">No reservations found for your caravans.</p>\n        )}\n\n        <div className=\"bg-white shadow overflow-hidden rounded-lg mt-4\">\n          <ul className=\"divide-y divide-gray-200\">\n            {reservations.map((reservation) => (\n              <li key={reservation.id} className=\"p-4 sm:p-6\">\n                <div className=\"flex items-center justify-between\">\n                  <div className=\"flex-1 min-w-0\">\n                    <p className=\"text-sm font-semibold text-indigo-600 truncate\">{reservation.caravan.name}</p>\n                    <p className=\"mt-1 text-sm text-gray-700\">\n                      <span className=\"font-medium\">Guest:</span> {reservation.guest.name} ({reservation.guest.email})\n                    </p>\n                    <p className=\"mt-1 text-sm text-gray-500\">\n                      {formatDate(reservation.startDate)} - {formatDate(reservation.endDate)}\n                    </p>\n                  </div>\n                  <div className=\"flex-shrink-0 ml-4 flex flex-col items-end space-y-2\">\n                    <p className=\"font-semibold\">‚Ç©{reservation.totalPrice.toLocaleString()}</p>\n                    <span className={`px-2 inline-flex text-xs leading-5 font-semibold rounded-full ${getStatusBadgeColor(reservation.status)}`}>\n                      {reservation.status}\n                    </span>\n                  </div>\n                </div>\n                {reservation.status === 'PENDING' && (\n                  <div className=\"mt-4 flex justify-end space-x-3\">\n                    <button\n                      onClick={() => handleStatusUpdate(reservation.id, 'CONFIRMED')}\n                      className=\"px-3 py-1 text-sm font-medium text-white bg-green-600 rounded-md hover:bg-green-700\"\n                    >\n                      ÏäπÏù∏\n                    </button>\n                    <button\n                      onClick={() => handleStatusUpdate(reservation.id, 'CANCELLED')}\n                      className=\"px-3 py-1 text-sm font-medium text-white bg-red-600 rounded-md hover:bg-red-700\"\n                    >\n                      Í±∞Ï†à\n                    </button>\n                  </div>\n                )}\n              </li>\n            ))}\n          </ul>\n        </div>\n      </div>\n    </main>\n  );\n}"],"names":[],"mappings":"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"}}]
}